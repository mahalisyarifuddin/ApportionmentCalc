<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ApportionmentCalc</title>
<style>
:root{--p:#0070ea;--ph:#005bc0;--bg:#f9f9ff;--s:#fff;--t:#414754;--b:#c1c6d7;--h:#d7d9e5;--ok:#28a745;--err:#dc3545}
@media(prefers-color-scheme:dark){:root:not(.light){--bg:#10131b;--s:#181c23;--t:#c1c6d7;--b:#414754;--h:#10131b}}
:root.dark{--bg:#10131b;--s:#181c23;--t:#c1c6d7;--b:#414754;--h:#10131b}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--t);font-family:sans-serif;display:flex;justify-content:center;min-height:100vh;padding:1rem}
.container{background:var(--s);border:1px solid var(--b);border-radius:8px;max-width:1000px;padding:2rem;width:100%;position:relative;margin-top:2rem}
.hidden{display:none!important}
h1,h2,h3,label{margin:.5rem 0}
label{display:block;font-weight:700}
input,select,button{background:var(--s);border:1px solid var(--b);border-radius:4px;color:var(--t);font-size:1rem;padding:.5rem;width:100%}
button{cursor:pointer;transition:background .2s}
.primary{background:var(--p);color:#fff;border:0}
.primary:hover{background:var(--ph)}
.secondary:hover{background:var(--h)}
.danger,.success{color:#fff;border:0}
.danger{background:var(--err)}
.success{background:var(--ok)}
.danger:hover,.success:hover{filter:brightness(.9)}
.selectors{position:absolute;right:2rem;top:1rem;display:flex;gap:8px}
.selectors select{font-size:.9rem;padding:5px;width:auto}
.row{display:flex;gap:1rem;margin-bottom:1rem}
.group{flex:1;margin-bottom:1rem}
.party-list,.party-row{margin-bottom:1rem;display:flex;gap:.5rem;align-items:center}
.party-list{display:block;margin-bottom:1rem}
.party-row input[type=text]{flex:2}
.party-row input[type=number]{flex:1}
.party-row button{width:auto;padding:.5rem 1rem}
.results-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem}
table{border-collapse:collapse;margin-top:1rem;width:100%;font-size:.9rem}
th,td{border:1px solid var(--b);padding:.5rem;text-align:left}
th{background:var(--p);color:#fff}
.comparison-section{margin-top:2rem;padding-top:1rem;border-top:1px solid var(--b)}
.pos{color:var(--ok);font-weight:700}
.neg{color:var(--err);font-weight:700}
.neu{opacity:.5}
.step{background:var(--s);border:1px solid var(--b);margin-bottom:1rem;padding:1rem;border-radius:4px}
.highlight{background:rgba(0,112,234,.1);font-weight:bold}
#visualizationModal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000}
#visualizationContent{background:var(--s);padding:2rem;border-radius:8px;max-width:90%;max-height:90%;overflow-y:auto;width:800px;position:relative}
#closeVisualization{position:absolute;top:1rem;right:1rem;width:auto;padding:.5rem 1rem}
.actions{display:flex;gap:1rem;margin-top:1rem;flex-wrap:wrap}
.actions button{flex:1}
.info{font-size:.9rem;opacity:.8;margin-bottom:.5rem}
@media(max-width:768px){.results-grid{grid-template-columns:1fr}.selectors{position:static;justify-content:flex-end;margin-bottom:.5rem}.row{flex-direction:column;gap:0}}
</style>
</head>
<body>
<div class="container">
<div class="selectors">
<select id="language"><option value="en">English</option><option value="id">Bahasa Indonesia</option></select>
<select id="theme"><option value="auto"></option><option value="light"></option><option value="dark"></option></select>
</div>
<h1 id="title"></h1>
<p id="subtitle" style="margin-bottom:1.5rem;opacity:.8"></p>
<div id="input">
<div class="row"><div class="group"><label id="seatsLabel" for="seats"></label><input type="number" id="seats" min="1" value="10"></div>
<div class="group"><label id="thresholdLabel" for="threshold"></label><input type="text" id="threshold" value="4"></div></div>
<div class="party-list" id="partyList"></div>
<button id="addParty" class="secondary" style="margin-bottom:1rem"></button><button id="calculate" class="primary"></button>
</div>
<div id="results" class="hidden">
<div class="actions"><button id="edit" class="secondary"></button><button id="showVisualization" class="secondary"></button><button id="export" class="success"></button></div>
<div class="results-grid"><div><h2 id="hareTitle"></h2><div id="hareResults"></div></div><div><h2 id="sainteLagueTitle"></h2><div id="sainteLagueResults"></div></div></div>
<div class="comparison-section"><h2 id="comparisonTitle"></h2><div id="comparisonResults"></div></div>
</div>
</div>
<div id="visualizationModal" class="hidden"><div id="visualizationContent"><button id="closeVisualization" class="secondary">×</button><h2 id="visualizationTitle"></h2><div id="visualizationSteps"></div></div></div>
<script>
const T={title:['ApportionmentCalc','ApportionmentCalc'],subtitle:['Electoral seat allocation calculator: Sainte Laguë vs Hare Quota','Kalkulator alokasi kursi pemilu: Sainte Laguë vs Kuota Hare'],autoTheme:['Auto Theme','Tema Otomatis'],lightTheme:['Light','Terang'],darkTheme:['Dark','Gelap'],seatsLabel:['Total Seats','Jumlah Kursi'],thresholdLabel:['Electoral Threshold (%)','Ambang Batas Parlemen (%)'],addParty:['+ Add Party','+ Tambah Partai'],calculate:['Calculate Allocation','Hitung Alokasi'],edit:['Edit Inputs','Ubah Input'],showVisualization:['Show Sainte Laguë Steps','Tampilkan Langkah Sainte Laguë'],export:['Export to CSV','Ekspor ke CSV'],hareTitle:['Hare Quota Method','Metode Kuota Hare'],sainteLagueTitle:['Sainte Laguë Method','Metode Sainte Laguë'],comparisonTitle:['Results Comparison','Perbandingan Hasil'],visualizationTitle:['Sainte Laguë Step-by-Step','Langkah-langkah Sainte Laguë'],party:['Party','Partai'],votes:['Votes','Suara'],seatsColumn:['Seats','Kursi'],remainder:['Remainder','Sisa'],diff:['Diff','Selisih'],quota:['Quota','BPP (Bilangan Pembagi Pemilih)'],totalVotes:['Total Valid Votes','Total Suara Sah'],thresholdVotes:['Threshold Votes','Suara Ambang Batas'],belowThreshold:['Parties below threshold','Partai di bawah ambang batas'],partyPlaceholder:['Party Name','Nama Partai'],votesPlaceholder:['Votes','Jumlah Suara'],alertSeats:['Total seats must be at least 1.','Jumlah kursi harus minimal 1.'],alertParties:['Please add at least one party with votes.','Harap tambahkan setidaknya satu partai dengan suara.'],round:['Round','Putaran'],winner:['Winner','Pemenang'],quotient:['Quotient','Bilangan'],divisor:['Divisor','Pembagi'],seatAllocated:['Seat #{n}','Kursi ke-{n}'],divisorsText:['Divisors: 1, 3, 5, 7...','Pembagi: 1, 3, 5, 7...'],quotientDetail:['Quotient Detail','Rincian Bilangan'],winnerPrefix:['Winner: ','Pemenang: ']};
const el=(t,p,c)=>{let e=Object.assign(document.createElement(t),p);if(c)e.append(...[c].flat());return e},esc=v=>el('p',{textContent:v}).innerHTML;
class App{
constructor(){
this.dom=Object.fromEntries([...document.querySelectorAll('[id]')].map(n=>[n.id,n]));
this.parties=Object.entries({'Apple Party':25000,'Banana Party':15000,'Cherry Party':9000,'Date Party':5000,'Elderberry Party':1500}).map(([name,votes],i)=>({id:i+1,name,votes}));
this.nextId=this.parties.length+1;
this.lang=navigator.language?.startsWith('id')?'id':'en';
this.bind();this.renderParties();this.setTheme('auto');this.setLang(this.lang);
}
bind(){
const d=this.dom,on=(i,h)=>d[i].onclick=h;
on('addParty',()=>this.addParty());on('calculate',()=>this.calculate());on('edit',()=>this.show('input'));
on('showVisualization',()=>this.toggleVis(1));on('closeVisualization',()=>this.toggleVis(0));on('export',()=>this.export());
d.visualizationModal.onclick=e=>e.target===d.visualizationModal&&this.toggleVis(0);
d.language.onchange=e=>this.setLang(e.target.value);d.theme.onchange=e=>this.setTheme(e.target.value);
}
str(k){return T[k]?.[this.lang==='id'?1:0]||k}
fmt(v,o={}){return v.toLocaleString(this.lang==='id'?'id-ID':'en-US',o)}
tpl(k,v){return Object.entries(v||{}).reduce((r,[x,y])=>r.replace(`{${x}}`,y),this.str(k))}
setTheme(t){
document.documentElement.className=t==='auto'?'':t;
this.dom.theme.value=t;
}
setLang(l){
this.lang=l;this.dom.language.value=l;document.documentElement.lang=l;
const d=this.dom,s=(i,k)=>d[i].textContent=this.str(k||i);
['title','subtitle','seatsLabel','thresholdLabel','addParty','calculate','edit','export','hareTitle','sainteLagueTitle','comparisonTitle','visualizationTitle'].forEach(i=>s(i));
d.showVisualization.textContent=this.str('showVisualization');
['autoTheme','lightTheme','darkTheme'].forEach((k,i)=>d.theme.options[i].textContent=this.str(k));
this.renderParties();
if(!d.results.classList.contains('hidden')&&this.data)this.renderResults();
}
show(s){['input','results'].forEach(i=>this.dom[i].classList.toggle('hidden',i!==s))}
toggleVis(v){this.dom.visualizationModal.classList.toggle('hidden',!v);if(v)this.renderVis()}
addParty(){this.parties.push({id:this.nextId++,name:'',votes:0});this.renderParties()}
renderParties(){
this.dom.partyList.replaceChildren(...this.parties.map(p=>el('div',{className:'party-row'},[
el('input',{type:'text',placeholder:this.str('partyPlaceholder'),value:p.name,onchange:e=>p.name=e.target.value}),
el('input',{type:'number',placeholder:this.str('votesPlaceholder'),value:p.votes||'',min:'0',onchange:e=>{p.votes=Math.round(parseFloat(e.target.value))||0;e.target.value=p.votes||''}}),
el('button',{className:'danger',textContent:'×',onclick:()=>{this.parties=this.parties.filter(x=>x.id!==p.id);this.renderParties()}})
])));
}
calculate(){
const seats=parseInt(this.dom.seats.value),thresh=parseFloat(this.dom.threshold.value.replace(',','.'))||0;
if(seats<1)return alert(this.str('alertSeats'));
const valid=this.parties.filter(p=>p.name&&p.votes>=0),total=valid.reduce((s,p)=>s+p.votes,0);
if(!valid.length||total===0)return alert(this.str('alertParties'));
const thrVotes=total*thresh/100,passed=valid.filter(p=>p.votes>=thrVotes);
if(!passed.length)return alert(this.str('belowThreshold'));
const quota=total/seats;
let hare=passed.map(p=>({...p,hSeats:Math.floor(p.votes/quota),rem:p.votes%quota}));
let allocated=hare.reduce((s,p)=>s+p.hSeats,0);
hare.sort((a,b)=>b.rem-a.rem||b.votes-a.votes);
for(let i=0;i<seats-allocated;i++)if(hare[i%hare.length])hare[i%hare.length].hSeats++;
let sl=passed.map(p=>({...p,sSeats:0})),steps=[];
for(let i=1;i<=seats;i++){
let max=-1,win=-1,qs=sl.map((p,idx)=>{
const d=2*p.sSeats+1,q=p.votes/d;
if(q>max){max=q;win=idx}
return{id:p.id,name:p.name,q,d};
});
if(win!==-1){sl[win].sSeats++;steps.push({r:i,win:sl[win].name,wid:sl[win].id,wq:max,qs});}
}
this.data={total,thrVotes,thresh,seats,quota,steps,res:valid.map(p=>{
const h=hare.find(x=>x.id===p.id),s=sl.find(x=>x.id===p.id);
return{...p,passed:p.votes>=thrVotes,hSeats:h?.hSeats||0,sSeats:s?.sSeats||0,rem:h?.rem||0};
})};
this.renderResults();this.show('results');
}
renderResults(){
if(!this.data)return;
const {res,total,thrVotes,thresh,quota}=this.data,pass=res.filter(r=>r.passed),fail=res.filter(r=>!r.passed);
const row=(r,s,x='')=>`<tr><td>${esc(r.name)}</td><td>${this.fmt(r.votes)}</td><td><strong>${s}</strong></td>${x}</tr>`;
this.dom.hareResults.innerHTML=`<p class="info">${this.str('quota')}: ${this.fmt(quota)}</p><p class="info">${this.str('totalVotes')}: ${this.fmt(total)}</p><p class="info">${this.str('thresholdVotes')} (${this.fmt(thresh)}%): ${this.fmt(thrVotes,{maximumFractionDigits:0})}</p><table><thead><tr><th>${this.str('party')}</th><th>${this.str('votes')}</th><th>${this.str('seatsColumn')}</th><th>${this.str('remainder')}</th></tr></thead><tbody>${[...pass].sort((a,b)=>b.hSeats-a.hSeats).map(r=>row(r,r.hSeats,`<td>${this.fmt(r.rem,{maximumFractionDigits:0})}</td>`)).join('')}</tbody></table>${fail.length?`<p class="info" style="margin-top:.5rem;font-style:italic">${this.str('belowThreshold')}: ${fail.map(p=>esc(p.name)).join(', ')}</p>`:''}`;
this.dom.sainteLagueResults.innerHTML=`<p class="info">${this.str('divisorsText')}</p><div style="height:3em"></div><table><thead><tr><th>${this.str('party')}</th><th>${this.str('votes')}</th><th>${this.str('seatsColumn')}</th></tr></thead><tbody>${[...pass].sort((a,b)=>b.sSeats-a.sSeats).map(r=>row(r,r.sSeats)).join('')}</tbody></table>`;
this.dom.comparisonResults.innerHTML=`<table><thead><tr><th>${this.str('party')}</th><th>Hare</th><th>Sainte-Laguë</th><th>${this.str('diff')}</th></tr></thead><tbody>${[...res].sort((a,b)=>b.votes-a.votes).map(r=>{const d=r.sSeats-r.hSeats,c=d>0?'pos':d<0?'neg':'neu';return`<tr><td>${esc(r.name)}${!r.passed?` ( < ${this.fmt(thresh)}%)`:''}</td><td>${r.hSeats}</td><td>${r.sSeats}</td><td class="${c}">${d>0?'+':''}${d}</td></tr>`}).join('')}</tbody></table>`;
}
renderVis(){
const {steps}=this.data;if(!steps?.length)return;
this.dom.visualizationSteps.innerHTML=`<table><thead><tr><th>${this.str('round')}</th><th>${this.str('winner')}</th><th>${this.str('quotient')}</th><th>${this.str('divisor')}</th></tr></thead><tbody>${steps.map(s=>`<tr><td>${this.tpl('seatAllocated',{n:s.r})}</td><td><strong>${esc(s.win)}</strong></td><td>${this.fmt(s.wq,{maximumFractionDigits:2})}</td><td>${s.qs.find(q=>q.id===s.wid).d}</td></tr>`).join('')}</tbody></table><h3 style="margin-top:2rem">${this.str('quotientDetail')}</h3>${steps.map(s=>`<div class="step"><h4>${this.tpl('seatAllocated',{n:s.r})} - ${this.str('winnerPrefix')}${esc(s.win)}</h4><table><tr>${s.qs.map(q=>`<th>${esc(q.name)} (/${q.d})</th>`).join('')}</tr><tr>${s.qs.map(q=>`<td class="${q.id===s.wid?'highlight':''}" style="${q.id===s.wid?'font-weight:bold':''}">${this.fmt(q.q,{maximumFractionDigits:2})}</td>`).join('')}</tr></table></div>`).join('')}`;
}
export(){
if(!this.data)return;
const {res}=this.data,total=res.reduce((s,p)=>s+p.votes,0);
const csv='Party,Votes,Share (%),Passed Threshold?,Hare Seats,Sainte-Laguë Seats,Difference\n'+res.map(r=>`"${r.name.replace(/"/g,'""')}",${r.votes},"${this.fmt(r.votes/total*100,{minimumFractionDigits:2,maximumFractionDigits:2})}",${r.passed?'Yes':'No'},${r.hSeats},${r.sSeats},${r.sSeats-r.hSeats}`).join('\n');
el('a',{href:URL.createObjectURL(new Blob([csv],{type:'text/csv'})),download:`apportionment_${new Date().toISOString().slice(0,19).replace(/[T:]/g,'-')}.csv`}).click();
}
}
new App();
</script>
</body>
</html>
